import{L as e}from"./4cc99b59.js";import{O as t,b as o}from"./65cdf028.js";import{w as i}from"./acda6ea6.js";import{a as s,x as n}from"./b4be29f1.js";import{M as l}from"./3599da39.js";import{C as a}from"./44105dd4.js";import{d as r}from"./dc2f5f5a.js";import{a as h}from"./0fc7fbf3.js";import{U as d}from"./c6fab747.js";const u=new WeakMap;function c(e,t){Array.from(e.childNodes).forEach(o=>{if("#text"===o.nodeName){const i=new RegExp(`^(.*?)(${t})(.*)$`,"i"),s=o.nodeValue.match(i);if(s){const t=document.createTextNode(s[1]);e.appendChild(t);const i=document.createElement("b");i.textContent=s[2],e.appendChild(i);const n=document.createTextNode(s[3]);e.appendChild(n),e.removeChild(o),u.set(e,()=>{e.appendChild(o),e.contains(t)&&null!==t.parentNode&&t.parentNode.removeChild(t),e.contains(i)&&null!==i.parentNode&&i.parentNode.removeChild(i),e.contains(n)&&null!==n.parentNode&&n.parentNode.removeChild(n)})}}else c(o,t)})}function p(e){u.has(e)&&u.get(e)(),Array.from(e.childNodes).forEach(e=>{"#text"===e.nodeName?u.has(e)&&u.get(e)():p(e)})}function _(e){return Array.isArray(e)?e:[e]}const m=r(e=>class extends(a(e)){static get properties(){return{allowCustomChoice:{type:Boolean,attribute:"allow-custom-choice"},modelValue:{type:Object}}}get modelValue(){return this.__getChoicesFrom(super.modelValue)}set modelValue(e){if(super.modelValue=e,null==e||""===e)this._customChoices=new Set;else if(this.allowCustomChoice){const t=this.modelValue;this._customChoices=new Set(_(e)),this.requestUpdate("modelValue",t)}}get formattedValue(){return this.__getChoicesFrom(super.formattedValue)}set formattedValue(e){if(super.formattedValue=e,null==e)this._customChoices=new Set;else if(this.allowCustomChoice){const t=this.modelValue;this._customChoices=new Set(_(e).map(e=>this.formElements.find(t=>t.formattedValue===e)?.modelValue||e)),this.requestUpdate("modelValue",t)}}get serializedValue(){return this.__getChoicesFrom(super.serializedValue)}set serializedValue(e){if(super.serializedValue=e,null==e)this._customChoices=new Set;else if(this.allowCustomChoice){const t=this.modelValue;this._customChoices=new Set(_(e).map(e=>this.formElements.find(t=>t.serializedValue===e)?.modelValue||e)),this.requestUpdate("modelValue",t)}}get customChoices(){if(!this.allowCustomChoice)return[];const e=this._getCheckedElements();return Array.from(this._customChoices).filter(t=>!e.some(e=>e.choiceValue===t))}constructor(){super(),this.allowCustomChoice=!1,this._customChoices=new Set}__getChoicesFrom(e){const t=e;return this.allowCustomChoice?this.multipleChoice?[..._(t),...this.customChoices]:""===t?this._customChoices.values().next().value||"":t:t}_isEmpty(){return super._isEmpty()&&0===this._customChoices.size}clear(){this._customChoices=new Set,super.clear()}parser(e){return this.allowCustomChoice&&Array.isArray(e)?e.filter(e=>""!==e.trim()):e}}),b=new WeakMap;class x extends(e(t(m(h)))){static get properties(){return{autocomplete:{type:String,reflect:!0},matchMode:{type:String,attribute:"match-mode"},showAllOnEmpty:{type:Boolean,attribute:"show-all-on-empty"},requireOptionMatch:{type:Boolean},allowCustomChoice:{type:Boolean,attribute:"allow-custom-choice"},__shouldAutocompleteNextUpdate:Boolean}}static get styles(){return[...super.styles,s`
        .input-group__input {
          display: flex;
          flex: 1;
        }

        .input-group__container {
          display: flex;
          border-bottom: 1px solid;
        }

        * > ::slotted([slot='input']) {
          outline: none;
          flex: 1;
          box-sizing: border-box;
          border: none;
          width: 100%;
          /* border-bottom: 1px solid; */
        }

        * > ::slotted([role='listbox']) {
          max-height: 200px;
          display: block;
          overflow: auto;
          z-index: 1;
          background: white;
        }
      `]}static get localizeNamespaces(){return[{"lion-combobox":e=>{switch(e){case"bg-BG":case"bg":return import("./89c2c72d.js");case"cs-CZ":case"cs":return import("./173b891d.js");case"de-AT":case"de-DE":case"de":return import("./22ba87d0.js");case"en-AU":case"en-GB":case"en-PH":case"en-US":case"en":default:return import("./aaeab458.js");case"es-ES":case"es":return import("./4a4feffd.js");case"fr-FR":case"fr-BE":case"fr":return import("./3c8d7f36.js");case"hu-HU":case"hu":return import("./295964d4.js");case"it-IT":case"it":return import("./350095fe.js");case"nl-BE":case"nl-NL":case"nl":return import("./dd9b575c.js");case"pl-PL":case"pl":return import("./ad3e6e18.js");case"ro-RO":case"ro":return import("./84fef14a.js");case"ru-RU":case"ru":return import("./19b06557.js");case"sk-SK":case"sk":return import("./c5202741.js");case"uk-UA":case"uk":return import("./146e5697.js");case"zh-CN":case"zh":return import("./aa13cd35.js")}}},...super.localizeNamespaces]}get modelValue(){const e=super.modelValue;return""!==e?e:this.parser(this.value)}set modelValue(e){super.modelValue=e}get value(){return this._inputNode?.value||this.__value||""}set value(e){this._inputNode?(this._inputNode.value=e,this.__value=void 0):this.__value=e}reset(){super.reset(),this.multipleChoice||(this.value=this._initialModelValue),this._resetListboxOptions()}_resetListboxOptions(){this.formElements.forEach((e,t)=>{this._unhighlightMatchedOption(e),this.showAllOnEmpty&&this.opened?(e.style.display="",e.setAttribute("aria-posinset",`${t+1}`),e.setAttribute("aria-setsize",`${this.formElements.length}`),e.removeAttribute("aria-hidden")):e.style.display="none"})}_inputGroupInputTemplate(){return n`
      <div class="input-group__input">
        <slot name="selection-display"></slot>
        <slot name="input"></slot>
      </div>
    `}_overlayListboxTemplate(){return n`
      <div
        id="overlay-content-node-wrapper"
        role="dialog"
        aria-label="${this.msgLit("lion-combobox:optionsPopup")}"
      >
        <slot name="listbox"></slot>
      </div>
      <slot id="options-outlet"></slot>
    `}_groupTwoTemplate(){return n` ${super._groupTwoTemplate()} ${this._overlayListboxTemplate()}`}get slots(){return{...super.slots,input:()=>{if("1.1"===this._ariaVersion){const e=document.createElement("div"),t=document.createElement("input");return t.style.cssText="\n          border: none;\n          outline: none;\n          width: 100%;\n          height: 100%;\n          font: inherit;\n          background: inherit;\n          color: inherit;\n          border-radius: inherit;\n          box-sizing: border-box;\n          padding: 0;",e.appendChild(t),e}return document.createElement("input")},listbox:super.slots.input}}get _comboboxNode(){return this.querySelector('[slot="input"]')}get _selectionDisplayNode(){return this.querySelector('[slot="selection-display"]')}get _inputNode(){return"1.1"===this._ariaVersion&&this._comboboxNode&&this._comboboxNode.querySelector("input")||this._comboboxNode}get _overlayContentNode(){return this._listboxNode}get _overlayReferenceNode(){return this.shadowRoot.querySelector(".input-group__container")}get _overlayInvokerNode(){return this._inputNode}get _listboxNode(){return this._overlayCtrl&&this._overlayCtrl.contentNode||Array.from(this.children).find(e=>"listbox"===e.slot)}get _activeDescendantOwnerNode(){return this._inputNode}get requireOptionMatch(){return!this.allowCustomChoice}set requireOptionMatch(e){this.allowCustomChoice=!e}constructor(){super(),this.autocomplete="both",this.matchMode="all",this.showAllOnEmpty=!1,this.requireOptionMatch=!0,this.rotateKeyboardNavigation=!0,this.selectionFollowsFocus=!0,this.defaultValidators.push(new l),this._ariaVersion=o.isChromium?"1.1":"1.0",this._listboxReceivesNoFocus=!0,this._noTypeAhead=!0,this.__prevCboxValueNonSelected="",this.__prevCboxValue="",this.__hadUserIntendsInlineAutoFill=!1,this.__listboxContentChanged=!1,this._onKeyUp=this._onKeyUp.bind(this),this._textboxOnClick=this._textboxOnClick.bind(this),this._textboxOnInput=this._textboxOnInput.bind(this),this._textboxOnKeydown=this._textboxOnKeydown.bind(this)}connectedCallback(){super.connectedCallback(),this._selectionDisplayNode&&(this._selectionDisplayNode.comboboxElement=this),(this.disabled||this.readOnly)&&this.__setComboboxDisabledAndReadOnly()}requestUpdate(e,t,o){if(super.requestUpdate(e,t,o),"disabled"!==e&&"readOnly"!==e||this.__setComboboxDisabledAndReadOnly(),"modelValue"===e&&this.modelValue&&this.modelValue!==t&&this._syncToTextboxCondition(this.modelValue,this._oldModelValue))if(this.multipleChoice)this._syncToTextboxMultiple(this.modelValue,this._oldModelValue);else{const e=this._getTextboxValueFromOption(this.formElements[this.checkedIndex]);this._setTextboxValue(e)}}parser(e){return this.requireOptionMatch&&-1===this.checkedIndex&&""!==e&&!Array.isArray(e)?new d(e):super.parser(e)}__unsyncCheckedIndexOnInputChange(){const e=this._autoSelectCondition(),t=this.formElements[this.checkedIndex];if(!this.multipleChoice&&!e&&t){const e=this._getTextboxValueFromOption(t);this._inputNode.value.startsWith(e)||this.setCheckedIndex(-1)}}updated(e){super.updated(e),e.has("__shouldAutocompleteNextUpdate")&&this.__unsyncCheckedIndexOnInputChange(),e.has("opened")&&(this.opened&&(this.activeIndex=-1),this.opened||void 0===e.get("opened")||(this.__onOverlayClose(),this.activeIndex=-1)),e.has("autocomplete")&&this._inputNode.setAttribute("aria-autocomplete",this.autocomplete),e.has("disabled")&&this.setAttribute("aria-disabled",`${this.disabled}`),e.has("__shouldAutocompleteNextUpdate")&&this.__shouldAutocompleteNextUpdate&&(this._handleAutocompletion(),this.__shouldAutocompleteNextUpdate=!1,this.__listboxContentChanged=!1),"function"==typeof this._selectionDisplayNode?.onComboboxElementUpdated&&this._selectionDisplayNode.onComboboxElementUpdated(e)}matchCondition(e,t){let o=-1;const i=this._getTextboxValueFromOption(e);return"string"==typeof i&&"string"==typeof t&&(o=i.toLowerCase().indexOf(t.toLowerCase())),"all"===this.matchMode?o>-1:0===o}_showOverlayCondition({lastKey:e}){return!(this.disabled||this.readOnly||e&&(["Tab","Escape"].includes(e)||!this.multipleChoice&&["Enter"].includes(e)))&&(!!(this.filled||this.showAllOnEmpty||!this.filled&&this.multipleChoice&&this.__prevCboxValueNonSelected)||this.opened)}_getTextboxValueFromOption(e){return e?e.choiceValue:this.modelValue instanceof d?this.modelValue.viewValue:this.modelValue}_onListboxContentChanged(){super._onListboxContentChanged(),this.__shouldAutocompleteNextUpdate=!0,this.__listboxContentChanged=!0}_textboxOnInput(e){this.__shouldAutocompleteNextUpdate=!0,this.opened=this._showOverlayCondition({})}_textboxOnKeydown(e){"Tab"===e.key&&(this.opened=!1)}_listboxOnClick(e){super._listboxOnClick(e),this._inputNode.focus(),this.multipleChoice?(this._inputNode.value="",this._resetListboxOptions()):(this.activeIndex=-1,this.opened=!1)}_setTextboxValue(e){this._inputNode&&this._inputNode.value!==e&&(this._inputNode.value=e)}__onOverlayClose(){this.multipleChoice?this._syncToTextboxMultiple(this.modelValue,this._oldModelValue):-1!==this.checkedIndex&&this._syncToTextboxCondition(this.modelValue,this._oldModelValue,{phase:"overlay-close"})&&(this._inputNode.value=this._getTextboxValueFromOption(this.formElements[this.checkedIndex]))}_repropagationCondition(e){return super._repropagationCondition(e)||this.formElements.every(e=>!e.checked)}_onFilterMatch(e,t){this._highlightMatchedOption(e,t),e.style.display=""}_highlightMatchedOption(e,t){if(c(e,t),e.textContent){const t=document.createElement("span");t.setAttribute("aria-label",e.textContent.replace(/\s+/g," ")),Array.from(e.childNodes).forEach(e=>{t.appendChild(e)}),e.appendChild(t),b.set(e,()=>{Array.from(t.childNodes).forEach(t=>{e.appendChild(t)}),e.contains(t)&&e.removeChild(t)})}}_onFilterUnmatch(e,t,o){this._unhighlightMatchedOption(e),e.style.display="none"}_unhighlightMatchedOption(e){p(e),b.has(e)&&b.get(e)()}__computeUserIntendsAutoFill({prevValue:e,curValue:t}){const o=e.length<t.length,i=e.length&&t.length&&e[0].toLowerCase()!==t[0].toLowerCase();return o||i||this.__listboxContentChanged&&this.__hadUserIntendsInlineAutoFill}_handleAutocompletion(){const e=!(this._inputNode.selectionStart===this._inputNode.selectionEnd)&&this._inputNode.value.length!==this._inputNode.selectionStart,t=this._inputNode.value,o=this._inputNode.selectionStart,i=e&&o?t.slice(0,o):t,s=e||this.__hadSelectionLastAutofill?this.__prevCboxValueNonSelected:this.__prevCboxValue,n=!i,l=[];let a=!1;const r=this.__computeUserIntendsAutoFill({prevValue:s,curValue:i}),h="both"===this.autocomplete||"inline"===this.autocomplete,d=this._autoSelectCondition(),u="inline"===this.autocomplete||"none"===this.autocomplete;this.formElements.forEach((e,t)=>{const o=this.matchCondition(e,i);let c=!1;if(c=n?this.showAllOnEmpty:u||o,d&&!a&&o&&!e.disabled){const o=()=>{this.activeIndex=t,this.selectionFollowsFocus&&!this.multipleChoice&&this.setCheckedIndex(this.activeIndex),a=!0};if(r)if(h){const t=this._getTextboxValueFromOption(e);t&&"string"==typeof t&&"string"==typeof i&&0===t.toLowerCase().indexOf(i.toLowerCase())&&(this.__textboxInlineComplete(e),o())}else o()}e.onFilterUnmatch?e.onFilterUnmatch(i,s):this._onFilterUnmatch(e,i,s),e.setAttribute("aria-hidden","true"),e.removeAttribute("aria-posinset"),e.removeAttribute("aria-setsize"),c&&(l.push(e),e.onFilterMatch?e.onFilterMatch(i):this._onFilterMatch(e,i))});const c=l.length;l.forEach((e,t)=>{e.setAttribute("aria-posinset",`${t+1}`),e.setAttribute("aria-setsize",`${c}`),e.removeAttribute("aria-hidden")}),!d||a||this.multipleChoice||(this.setCheckedIndex(-1),s!==i&&(this.activeIndex=-1),this.modelValue=this.parser(t)),this.__prevCboxValueNonSelected=i,this.__prevCboxValue=this._inputNode.value,this.__hadSelectionLastAutofill=this._inputNode.value.length!==this._inputNode.selectionStart,this.__hadUserIntendsInlineAutoFill=r,this._overlayCtrl&&this._overlayCtrl._popper&&this._overlayCtrl._popper.update()}__textboxInlineComplete(e=this.formElements[this.activeIndex]){const t=this._getTextboxValueFromOption(e);if(this._inputNode.value!==t){const e=this._inputNode.value.length;this._inputNode.value=t,this._inputNode.selectionStart=e,this._inputNode.selectionEnd=this._inputNode.value.length}}_autoSelectCondition(){return"both"===this.autocomplete||"inline"===this.autocomplete}_setupListboxNode(){super._setupListboxNode(),this._listboxNode.removeAttribute("tabindex")}_defineOverlayConfig(){return{...i(),elementToFocusAfterHide:void 0,invokerNode:this._comboboxNode,visibilityTriggerFunction:void 0}}_setupOverlayCtrl(){super._setupOverlayCtrl(),this.__shouldAutocompleteNextUpdate=!0,this.__setupCombobox()}_teardownOverlayCtrl(){super._teardownOverlayCtrl(),this.__teardownCombobox()}_setupOpenCloseListeners(){super._setupOpenCloseListeners(),this._inputNode.addEventListener("keyup",this._onKeyUp),this._inputNode.addEventListener("click",this._textboxOnClick)}_teardownOpenCloseListeners(){super._teardownOpenCloseListeners(),this._inputNode.removeEventListener("keyup",this._onKeyUp),this._inputNode.removeEventListener("click",this._textboxOnClick)}_listboxOnKeyDown(e){const{key:t}=e;switch(t){case"Escape":this.opened=!1,super._listboxOnKeyDown(e),this._setTextboxValue("");break;case"Backspace":case"Delete":this.requireOptionMatch?super._listboxOnKeyDown(e):this.opened=!1;break;case"Enter":this.opened&&e.preventDefault(),this.requireOptionMatch||!this.multipleChoice||this.formElements[this.activeIndex]&&!this.formElements[this.activeIndex].hasAttribute("aria-hidden")&&this.opened?(super._listboxOnKeyDown(e),this._resetListboxOptions()):(this.modelValue=this.parser([...this.modelValue,this._inputNode.value]),this._inputNode.value="",this.opened=!1),this.multipleChoice?this._inputNode.value="":this.opened=!1;break;default:super._listboxOnKeyDown(e)}}_syncToTextboxCondition(e,t,{phase:o}={}){return"both"===this.autocomplete||"inline"===this.autocomplete||!this.focused}_syncToTextboxMultiple(e,t=[]){if(this.requireOptionMatch){const o=e.filter(e=>!t.includes(e)),i=this.formElements.filter(e=>o.includes(e.choiceValue)).map(e=>this._getTextboxValueFromOption(e)).join(" ");this._setTextboxValue(i)}}_enhanceLightDomClasses(){const e=this.querySelector("[slot=input]");e&&e.classList.add("form-control")}__setComboboxDisabledAndReadOnly(){this._comboboxNode&&(this._comboboxNode.toggleAttribute("disabled",this.disabled),this._comboboxNode.setAttribute("aria-disabled",`${this.disabled}`),this._comboboxNode.toggleAttribute("readonly",this.readOnly),this._comboboxNode.setAttribute("aria-readonly",`${this.readOnly}`)),this._inputNode&&(this._inputNode.toggleAttribute("disabled",this.disabled),this._inputNode.toggleAttribute("readOnly",this.readOnly),this._inputNode.setAttribute("aria-readonly",`${this.readOnly}`),this._inputNode.tabIndex=this.disabled?-1:0)}__setupCombobox(){this._comboboxNode.setAttribute("role","combobox"),this._comboboxNode.setAttribute("aria-haspopup","listbox"),this._inputNode.setAttribute("aria-autocomplete",this.autocomplete),this._comboboxNode.setAttribute("aria-controls",this._listboxNode.id),"1.1"===this._ariaVersion?this._comboboxNode.setAttribute("aria-owns",this._listboxNode.id):this._inputNode.setAttribute("aria-owns",this._listboxNode.id),this._listboxNode.setAttribute("aria-labelledby",this._labelNode.id),this._inputNode.addEventListener("keydown",this._listboxOnKeyDown),this._inputNode.addEventListener("input",this._textboxOnInput),this._inputNode.addEventListener("keydown",this._textboxOnKeydown)}__teardownCombobox(){this._inputNode.removeEventListener("keydown",this._listboxOnKeyDown),this._inputNode.removeEventListener("input",this._textboxOnInput),this._inputNode.removeEventListener("keydown",this._textboxOnKeydown)}_onKeyUp(e){const t=e&&e.key;this.opened=this._showOverlayCondition({lastKey:t,currentValue:this._inputNode.value})}_textboxOnClick(e){this.opened=this._showOverlayCondition({})}clear(){this.value="",super.clear(),this.__shouldAutocompleteNextUpdate=!0}}export{x as L};
